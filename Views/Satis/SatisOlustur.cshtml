
@{
    ViewBag.Title = "SatisOlustur";
    Layout = "~/Views/Shared/_Layout.cshtml";
}


<form class="form-group" method="post" style="width:80%; margin:auto">

    <div class="input-group mb-3">
        <span class="input-group-text">Ürün: </span>
        <select class="form-select" id="urun" name="Urun">
            @foreach (var urun in ViewBag.urunList)
            {
                if (urun.IsActive == true)
                {
                    <option value="@urun.UrunID">@urun.UrunAd</option>
                }
            }
        </select>
    </div>
    <div class="input-group mb-3">
        <span class="input-group-text">Müşteri: </span>
        <select class="form-select" id="musteri" name="Musteri">
            @foreach (var musteri in ViewBag.musteriList)
            {
                if (musteri.IsActive == true)
                {
                    <option value="@musteri.MusteriID">@musteri.MusteriAd @musteri.MusteriSoyad</option>
                }
            }
        </select>
    </div>

    <div class="input-group mb-3">

        <span class="input-group-text">Adet: </span>
        <input type="number" class="form-control" id="adet" name="Adet" />

    </div>

    <div class="input-group mb-3">

        <span class="input-group-text">Toplam Fiyat: </span>
        <input type="text" class="form-control" id="toplamFiyat" name="ToplamFiyat" />
        <span class="input-group-text">₺</span>

    </div>

    <div>

        <button type="button" onclick="submitForm()" class="btn btn-info">Satış Ekle</button>

    </div>

</form>

<script>
    function submitForm() {
        // Form verilerini al
        var formData = {
            Urun: $('#urun').val(),
            Musteri: $('#musteri').val(),
            Adet: $('#adet').val(),
            ToplamFiyat: $('#toplamFiyat').val()
        };

        // AJAX isteği gönder
        $.ajax({
            url: '/Satis/SatisOlustur',
            type: 'POST',
            data: JSON.stringify(formData),
            contentType: 'application/json',
            success: function (response) {
                if (!response.success) {
                    // Satış işlemi başarısız oldu, hata mesajını göster
                    alert(response.message);
                } else {
                    // Satış işlemi başarılı, istenilen sayfaya yönlendir
                    window.location.href = '/Satis/SatisIndex'; // Yönlendirilecek sayfanın URL'sini belirtin
                }
            },
            error: function (xhr, status, error) {
                // İşlem sırasında bir hata oluştuğunda yapılacak işlemler
                console.log(xhr.responseText);
            }
        });
    }
</script>